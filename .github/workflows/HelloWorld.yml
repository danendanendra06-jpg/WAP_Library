name: CI/CD Auto Deploy Vehicle Wash

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:

  # =====================================================
  # JOB 1 ‚Äî DEPLOY KE LAPTOP ANDA (my_laptop)
  # =====================================================
  deploy_my_laptop:
    runs-on: [my_laptop]

    steps:
      # Step 1: Checkout kode (WAJIB untuk self-hosted runner)
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Tentukan folder project
      - name: Set project path
        run: |
          PROJECT_PATH="$HOME/web_vehiclewash"
          echo "PROJECT_PATH=$PROJECT_PATH" >> $GITHUB_ENV
          echo "üìÅ Project Path: $PROJECT_PATH"

      # Step 3: Pull update dari GitHub ke folder project lokal
      - name: Pull latest changes
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          git fetch origin master
          git reset --hard origin/master

      # Step 4: Restart Docker
      - name: Restart Docker Containers
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          docker compose down || true
          docker compose up -d --build

  # =====================================================
  # JOB 2 ‚Äî DEPLOY KE LAPTOP TEMAN (laptop_Nashwan)
  # =====================================================
  deploy_nashwan:
    runs-on: [laptop_husain]

    steps:
      # Step 1: Checkout kode
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Tentukan folder project
      - name: Set project path
        run: |
          PROJECT_PATH="$HOME/web_vehiclewash"
          echo "PROJECT_PATH=$PROJECT_PATH" >> $GITHUB_ENV
          echo "üìÅ Project Path: $PROJECT_PATH"

      # Step 3: Tarik update dari GitHub
      - name: Pull latest changes
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          git fetch origin master
          git reset --hard origin/master

      # Step 4: Restart Docker
      - name: Restart Docker Containers
        working-directory: ${{ env.PROJECT_PATH }}
        run: |
          docker compose down || true
          docker compose up -d --build
